name: 豆子戰情室自動更新

on:
  schedule:
    # 每 4 小時自動跑一次 (UTC 時間，換算台灣時間約 02:00, 06:00, 10:00...)
    - cron: '0 */4 * * *'
  workflow_dispatch: # 允許你手動點擊按鈕執行

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 檢出程式碼
        uses: actions/checkout@v3

      - name: 設定 Python 環境
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 安裝必要套件
        run: |
          python -m pip install --upgrade pip
          # googletrans 3.1.0a0 是目前在 Actions 環境中最穩定的版本
          pip install feedparser googletrans==3.1.0a0 pytz python-dateutil requests beautifulsoup4 urllib3

      - name: 執行新聞抓取 (main.py)
        run: python main.py

      - name: 提交並推送更新 (解決衝突版)
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add index.html
          # 如果沒有檔案變動，則跳過 commit
          git commit -m "自動更新新聞: $(date)" || exit 0
          # 使用 rebase 模式拉取，避免你手動改 code 後機器人推不上去
          git pull --rebase origin main
          git push origin main
